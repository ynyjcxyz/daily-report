<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œæ—¥æŠ¥ç”Ÿæˆå™¨ (å¸¦é•¿æˆªå›¾)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* å…¨å±€æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 15px;
            color: #333;
        }

        h2 { text-align: center; color: #333; }

        /* è¾“å…¥åŒºåŸŸæ ·å¼ */
        .input-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* ç¡®ä¿ä¸æ’‘ç ´å®¹å™¨ */
            font-size: 14px;
        }

        textarea {
            height: 80px;
            resize: vertical;
        }

        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }

        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; display: none; /* é»˜è®¤éšè—ä¿å­˜æŒ‰é’® */ }
        
        /* === æ ¸å¿ƒï¼šç”Ÿæˆçš„æ—¥æŠ¥é¢„è§ˆåŒºåŸŸ (ä¹Ÿæ˜¯è¢«æˆªå›¾çš„åŒºåŸŸ) === */
        #preview-area {
            background: white;
            padding: 25px; /* å›¾ç‰‡å‘¨è¾¹çš„ç™½è¾¹ */
            border-radius: 0; /* æˆªå›¾æ—¶ç›´è§’æ¯”è¾ƒæ­£å¼ */
            margin-bottom: 20px;
            display: none; /* é»˜è®¤éšè—ï¼Œç‚¹å‡»ç”Ÿæˆåæ˜¾ç¤º */
        }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #333; /* å¤–æ¡†åŠ ç²— */
        }

        th, td {
            border: 1px solid #666;
            padding: 12px;
            vertical-align: top;
        }

        th {
            background-color: #f0f0f0;
            width: 25%;
            white-space: nowrap;
            text-align: center;
        }

        td {
            line-height: 1.6;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .report-date {
            text-align: right;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>

    <div class="input-group">
        <h2>âœï¸ å¡«å†™æ—¥æŠ¥</h2>
        
        <label>ä»Šæ—¥å·¥ä½œå†…å®¹ (æ¢è¡Œå³åˆ†æ¡)ï¼š</label>
        <textarea id="input-work" placeholder="1. ä¿®å¤äº†è€³æœºè“ç‰™è¿æ¥ä¸ç¨³å®šçš„é—®é¢˜&#10;2. å®Œæˆäº†20å°è®¾å¤‡çš„æ£€æµ‹..."></textarea>

        <label>é‡åˆ°çš„é—®é¢˜/å›°éš¾ï¼š</label>
        <textarea id="input-issue" placeholder="æš‚æ— ï¼Œæˆ–è€…å¡«å†™å…·ä½“ç¼ºå°‘ä»€ä¹ˆé…ä»¶..."></textarea>

        <label>æ˜æ—¥è®¡åˆ’ï¼š</label>
        <textarea id="input-plan" placeholder="1. ç»§ç»­æ¸…ç†åº“å­˜..."></textarea>

        <button class="btn btn-primary" onclick="generateTable()">ğŸ‘‡ 1. ç”Ÿæˆè¡¨æ ¼é¢„è§ˆ</button>
    </div>

    <div id="preview-area">
        <div id="capture-target">
            <div class="report-header">
                <h2 style="margin:0;">æ¯æ—¥å·¥ä½œæŠ¥å‘Š</h2>
            </div>
            <div class="report-date">æ—¥æœŸï¼š<span id="date-display"></span></div>
            
            <table>
                <tbody>
                    <tr>
                        <th>ä»Šæ—¥å·¥ä½œ</th>
                        <td id="td-work"></td>
                    </tr>
                    <tr>
                        <th>é—®é¢˜ä¸å›°éš¾</th>
                        <td id="td-issue"></td>
                    </tr>
                    <tr>
                        <th>æ˜æ—¥è®¡åˆ’</th>
                        <td id="td-plan"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <button id="btn-download" class="btn btn-success" onclick="saveAsImage()">ğŸ“¸ 2. ä¿å­˜ä¸ºé•¿å›¾ç‰‡</button>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸ
        document.getElementById('date-display').innerText = new Date().toLocaleDateString();

        // æŠŠæ–‡æœ¬åŸŸé‡Œçš„æ¢è¡Œç¬¦è½¬æ¢æˆ HTML çš„ <br>
        function formatText(text) {
            if (!text) return "æ— ";
            return text.replace(/\n/g, '<br>');
        }

        // 1. ç”Ÿæˆè¡¨æ ¼åŠŸèƒ½
        function generateTable() {
            // è·å–è¾“å…¥
            const work = document.getElementById('input-work').value;
            const issue = document.getElementById('input-issue').value;
            const plan = document.getElementById('input-plan').value;

            // å¡«å……è¡¨æ ¼
            document.getElementById('td-work').innerHTML = formatText(work);
            document.getElementById('td-issue').innerHTML = formatText(issue);
            document.getElementById('td-plan').innerHTML = formatText(plan);

            // æ˜¾ç¤ºé¢„è§ˆåŒºåŸŸå’Œä¸‹è½½æŒ‰é’®
            document.getElementById('preview-area').style.display = 'block';
            document.getElementById('btn-download').style.display = 'block';

            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæ–¹ä¾¿æŸ¥çœ‹
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // 2. æˆªå›¾ä¸‹è½½åŠŸèƒ½ (æ ¸å¿ƒé€»è¾‘)
        function saveAsImage() {
            const element = document.getElementById('capture-target'); // åªæˆªå–ç™½è‰²å¡ç‰‡å†…éƒ¨ï¼Œä¸æˆªå–ç°è‰²èƒŒæ™¯

            html2canvas(element, {
                scale: 2, // 2å€æ¸…æ™°åº¦
                useCORS: true,
                backgroundColor: "#ffffff", // ç¡®ä¿èƒŒæ™¯æ˜¯ç™½çš„
                windowHeight: element.scrollHeight, // å…³é”®ï¼šç¡®ä¿æˆªå–å®Œæ•´é«˜åº¦
            }).then(canvas => {
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                const dateStr = new Date().toISOString().slice(0,10);
                link.download = `å·¥ä½œæ—¥æŠ¥_${dateStr}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(err => {
                alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•");
                console.error(err);
            });
        }
    </script>
</body>
</html>
